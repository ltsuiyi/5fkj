<!DOCTYPE html>
<html>
{include file="common/header"}
<style type="text/css">
    .uploader-list {
        margin-left: -15px;
    }

    .uploader-list .info {
        position: relative;
        margin-top: -25px;
        background-color: black;
        color: white;
        filter: alpha(Opacity=80);
        -moz-opacity: 0.5;
        opacity: 0.5;
        width: 100px;
        height: 25px;
        text-align: center;
        display: none;
    }

    .uploader-list .handle {
        position: relative;
        background-color: black;
        color: white;
        filter: alpha(Opacity=80);
        -moz-opacity: 0.5;
        opacity: 0.5;
        width: 100px;
        text-align: right;
        height: 18px;
        margin-bottom: -18px;
        display: none;
    }

    .uploader-list .handle i {
        margin-right: 5px;
    }

    .uploader-list .handle i:hover {
        cursor: pointer;
    }

    .uploader-list .file-iteme {
        margin: 12px 0 0 15px;
        padding: 1px;
        float: left;
    }
</style>
<body>
<div class="layui-fluid" style="padding-top: 20px">
<form class="layui-form layui-form-pane" action="">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-block">
                <input type="text" name="user_name"  lay-verify="required" autocomplete="off"  class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">真实姓名</label>
            <div class="layui-input-inline">
                <input type="text" name="real_name"  lay-verify="required"autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">电话</label>
            <div class="layui-input-inline">
                <input type="text" name="phone"  lay-verify="required"autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">密码</label>
        <div class="layui-input-block">
            <input type="text" name="password" lay-verify="required" autocomplete="off" placeholder="请输入密码" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">所属公司</label>
        <div class="layui-input-inline " >
            <select class="layui-select"   id="type_id" name="company_id">
                <option value="">请选择</option>
            </select>
        </div>
        <label class="layui-form-label">所属用户组</label>
        <div class="layui-input-inline">
            <select class="layui-select" id="lation_id" name="group_id">
                <option value="">请选择</option>
            </select>
        </div>
        <label class="layui-form-label">性别</label>
        <div class="layui-input-inline">
            <select class="layui-select"  name="sex">
                <option value="">请选择</option>
                <option value="1">女</option>
                <option value="2">男</option>
                <option value="3">保密</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item" pane="">
        <label class="layui-form-label">状态</label>
        <div class="layui-input-block">
            <input type="radio" name="status" value="1" title="启用" checked="">
            <input type="radio" name="status" value="-1" title="未启用">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-upload">
            <button type="button" class="layui-btn" id="test2">上传头像</button>
            <blockquote  class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;width: 88%">
                预览图：
                <div class="layui-upload-list uploader-list" style="overflow: auto;" id="uploader-list">
                </div>
                <input type="hidden" name="head_image">
            </blockquote>
        </div>
    </div>
    <div class="layui-form-item layui-layout-admin " style="width: 100%">
        <div class="layui-input-block">
            <div class="layui-footer" style="left: 0px;text-align: center;">
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </div>
</form>
</div>
<script src="__layuiadmin__/layui/layui.js"></script>
<script src="/static/admin/js/http.js"></script>

<script>


    layui.use(['form', 'layedit', 'upload','laydate','element'], function(){
         var $ = layui.$
            ,form = layui.form
            ,layer = layui.layer
        var upload = layui.upload;
        var element = layui.element;
        var loading_count = 0;



        /*鼠标悬浮*/
        $(document).on("mouseenter mouseleave", ".file-iteme", function(event){
            if(event.type === "mouseenter"){
                //鼠标悬浮
                $(this).children(".info").fadeIn("fast");
                $(this).children(".handle").fadeIn("fast");
            }else if(event.type === "mouseleave") {
                //鼠标离开
                $(this).children(".info").hide();
                $(this).children(".handle").hide();
            }
        });

        /*上传图片*/
        upload.render({
            elem: '#test2'
            ,url: $api+'admin/Upload/upload'
            ,multiple: true
            ,before: function(obj){
                layer.msg('图片上传中...', {
                    icon: 16,
                    shade: 0.01,
                    time: 0
                })
            }
            ,done: function(res){
                layer.close(layer.msg());//关闭上传提示窗口
                if (res.status ==0){
                    return  layer.msg(res.msg, {time:2000, shade:0.3});
                }else
                $('#uploader-list').append(
                    '<div id="" class="file-iteme">' +
                    '<div class="handle"><i class="layui-icon layui-icon-delete"></i></div>' +
                    '<img id="img" style="width: 100px;height: 100px;" src='+ res.src +'>' +
                    '<div class="info">' + res.title + '</div>' +
                    '<input type="hidden" name="picture[]" value='+ res.src +'>'+
                    '</div>'
                );
                //上传完毕
            }
        });

        /*删除图片未完成*/
        $(document).on("click", ".file-iteme .handle", function(event){
                var img =$(this).attr('src');
                console.log(img)
        });

        /*
      * 获取土地分类数据*/
        $.ajax({
            url:$api+'admin/LandType/getList',   //后台数据地址
            success: function (data) {
                $.each(data.data,function (index,item) {   //循环后台返回的json数据
                    //new Option方法是新建一个option，第一个参数是需要显示的值，第二个参数是option的value值,然后append到下拉框中。
                    $('#type_id').append(new Option(item.title,item.id));
                })
                layui.form.render("select");
            }
        })
        /*
       * 获取土地流转分类数据*/
        $.ajax({
            url:$api+'admin/LatinType/getList',   //后台数据地址
            success: function (data) {
                $.each(data.data,function (index,item) {   //循环后台返回的json数据
                    //new Option方法是新建一个option，第一个参数是需要显示的值，第二个参数是option的value值,然后append到下拉框中。
                    $('#lation_id').append(new Option(item.title,item.id));
                })
                layui.form.render("select");
            }
        })
        //监听提交
        form.on('submit(add)', function(data){
            var data = data.field;
            $.ajax({
                url: 'doAll',
                type : "POST",
                async: false,
                dataType : "json",
                data:data,
                success : function(res) {
                    if (res.code == 200) {
                        layer.msg(res.msg, {time:2000, shade:0.3}, function (){
                            // parent.layui.table.reload('test');//重载父页表格，参数为表格ID
                            // // table.reload('test');
                            // layer.close(index);
                            window.parent.location.reload();
                            parent.layer.close(index);     //添加成功之后销毁当前弹窗
                        });
                    } else {
                        layer.msg(res.msg, {icon: 5});
                    }
                },
            });
            return false;
        });
    });
</script>
</body>
</html>